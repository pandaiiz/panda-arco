import{r as d,n as a,d as j,l as B,j as i,a as x,h as b,B as F,p as K,m as W,k as G}from"./index-2fe9f87b.js";/* empty css              */import"./index-051f16ed.js";import{S as p}from"./index-99f088e0.js";import{T as P}from"./index-18b86337.js";import"./index-a8984739.js";import{d as U}from"./service-735e5b75.js";import A from"./pictureUpload-b2c3a753.js";import{a as L}from"./service-39d851c5.js";import{T as k}from"./index-26e1abb8.js";import"./select-view-e3752154.js";import"./index-a3018368.js";import"./index-36185895.js";import"./index-ed7d1e53.js";import"./index-6b64cf7e.js";import"./index.browser-7e542916.js";import"./rotate-c57d4b9d.js";const oe=({detailData:l,setDetailData:c,setSelectedRow:I,selectedRow:m})=>{const[q,C]=d.useState([]),[O,S]=d.useState(!1),u=d.useRef(null),E=d.useCallback(a.debounce(o=>{u.current=Date.now();const t=u.current;S(!0),C([]),L(o).then(n=>{u.current===t&&n&&(S(!1),C(n))})},500),[]),{data:y}=j(()=>B("CATEGORY")),R=[{title:"品名",dataIndex:"category",align:"center",width:160,render:(o,t,n)=>i(p,{disabled:t.status===1,placeholder:"请选择品名",allowClear:!0,value:t.category,onChange:(r,e)=>{const s=N.filter(f=>f!==t.nanoid),g=m.filter(f=>f.nanoid!==t.nanoid);w(s),I(g);const h=a.cloneDeep(l);r?(h[n].category=r,h[n].categoryName="children"in e?e.children:""):(h[n].category="",h[n].categoryName=""),c(h)},children:y==null?void 0:y.map(r=>i(p.Option,{value:r.key,children:r.title},r.id))})},{title:"款号",dataIndex:"styleId",align:"center",width:300,render:(o,t,n)=>{var r;return t.styleId?x(b.Group,{compact:!0,children:[i(b,{disabled:!0,value:(r=t==null?void 0:t.style)==null?void 0:r.styleCode,style:{width:"75%"}}),i(F,{style:{width:"25%"},type:"primary",onClick:()=>{const e=a.cloneDeep(l);e[n].styleId="",c(e)},children:"修改"})]}):i(p,{showSearch:!0,placeholder:"根据款号/标签搜索",filterOption:!1,renderFormat:e=>e.children.props.children[1],notFoundContent:O?i("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:i(K,{style:{margin:12}})}):null,onSearch:E,onChange:e=>{const s=a.cloneDeep(l);s[n].styleId=(e==null?void 0:e.id)||"",s[n].style=e||"",s[n].category=(e==null?void 0:e.category)||"",s[n].categoryName=(e==null?void 0:e.categoryName)||"",c(s)},children:q.map(e=>i(p.Option,{value:e,children:e.styleCode},e.id))})}},{title:"图片",dataIndex:"imgSrc",align:"center",render:(o,t,n)=>i(A,{url:t.imgSrc,onChange:r=>{var s,g;const e=a.cloneDeep(l);e[n].imgSrc=(g=(s=r[0])==null?void 0:s.response)==null?void 0:g.src,c(e)}})},{title:"圈号",dataIndex:"circle",align:"center",width:100,render:(o,t,n)=>i(b,{disabled:t.status===1,value:t.circle,onChange:r=>{const e=a.cloneDeep(l);e[n].circle=r,c(e)}})},{title:"件重",dataIndex:"singleWeight",align:"center",width:100,render:(o,t,n)=>i(W,{disabled:t.status===1,value:t.singleWeight,onChange:r=>{const e=a.cloneDeep(l);e[n].singleWeight=r,e[n].totalWeight=t.quantity&&r&&Number((Number(t.quantity)*Number(r)).toFixed(2)),c(e)}})},{title:"数量",dataIndex:"quantity",align:"center",width:100,render:(o,t,n)=>i(W,{disabled:t.status===1,value:t.quantity,onChange:r=>{const e=a.cloneDeep(l);e[n].quantity=r,e[n].totalWeight=r&&t.singleWeight&&Number((Number(r)*Number(t.singleWeight)).toFixed(2)),c(e)}})},{title:"状态",align:"center",dataIndex:"status",width:100,render:o=>x(G,{children:[o===0&&i(k,{color:"red",children:"未排产"}),o===1&&i(k,{color:"green",children:"已排产"})]})},{title:"总重",align:"center",dataIndex:"totalWeight",width:100},{title:"操作",align:"center",width:120,render:(o,t,n)=>i(F,{disabled:t.status===1,type:"text",onClick:()=>T(t.id,n),children:"删除"})}],T=async(o,t)=>{o&&await U(o),c(l.filter((n,r)=>r!==t))},[N,w]=d.useState([]);return d.useEffect(()=>{w(m.map(o=>o.nanoid))},[m]),i(P,{scroll:{y:window.screen.height-300},columns:R,data:l,pagination:!1,rowKey:"nanoid",rowSelection:{type:"checkbox",selectedRowKeys:N,onChange:(o,t)=>{w(o),I(t)},checkboxProps:o=>({disabled:!o.category||o.status===1})}})};export{oe as default};
