import{r as d,n as l,d as U,l as V,a as h,k as j,j as r,h as g,B as I,p as A,m as E}from"./index-2fe9f87b.js";/* empty css              */import"./index-051f16ed.js";import{S as y}from"./index-99f088e0.js";import{T as L}from"./index-18b86337.js";import"./index-a8984739.js";import{d as Y}from"./service-735e5b75.js";import z from"./pictureUpload-b2c3a753.js";import{a as H}from"./service-39d851c5.js";import J from"./findStyle-b646b788.js";import{T as R}from"./index-26e1abb8.js";import"./select-view-e3752154.js";import"./index-a3018368.js";import"./index-36185895.js";import"./index-ed7d1e53.js";import"./index-6b64cf7e.js";import"./index.browser-7e542916.js";import"./rotate-c57d4b9d.js";import"./StyleFilter-967f201e.js";import"./index-1c0548d1.js";import"./scrollIntoView-eed899c1.js";import"./index-ed740d17.js";import"./form-de005383.js";import"./common-26ce2b19.js";import"./service-82e768f3.js";import"./index-5c024e38.js";import"./constants-filter-c5ec6bba.js";import"./image-d5b95c01.js";import"./edit-aacc2711.js";import"./index-e5c443e4.js";import"./mobileFilter-588aaca9.js";const Ne=({detailData:s,setDetailData:a,setSelectedRow:C,selectedRow:u})=>{const[T,N]=d.useState([]),[B,F]=d.useState(!1),[x,k]=d.useState({}),[W,O]=d.useState(!1),f=d.useRef(null),K=d.useCallback(l.debounce(n=>{f.current=Date.now();const e=f.current;F(!0),N([]),H(n).then(i=>{f.current===e&&i&&(F(!1),N(i))})},500),[]),{data:w}=U(()=>V("CATEGORY")),G=[{title:"品名",dataIndex:"category",align:"center",width:160,render:(n,e,i)=>r(y,{disabled:e.status===1,placeholder:"请选择品名",allowClear:!0,value:e.category,onChange:(o,t)=>{const c=q.filter(S=>S!==e.nanoid),m=u.filter(S=>S.nanoid!==e.nanoid);b(c),C(m);const p=l.cloneDeep(s);o?(p[i].category=o,p[i].categoryName="children"in t?t.children:""):(p[i].category="",p[i].categoryName=""),a(p)},children:w==null?void 0:w.map(o=>r(y.Option,{value:o.key,children:o.title},o.id))})},{title:"款号",dataIndex:"styleId",align:"center",width:300,render:(n,e,i)=>{var o;return e.styleId?h(g.Group,{compact:!0,children:[r(g,{disabled:!0,value:(o=e==null?void 0:e.style)==null?void 0:o.styleCode,style:{width:"75%"}}),r(I,{style:{width:"25%"},status:"danger",onClick:()=>{const t=l.cloneDeep(s);t[i].styleId="",a(t)},children:"修改"})]}):h(g.Group,{compact:!0,children:[r(y,{style:{width:"75%"},showSearch:!0,placeholder:"根据款号/标签搜索",filterOption:!1,renderFormat:t=>t.children.props.children[1],notFoundContent:B?r("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:r(A,{style:{margin:12}})}):null,onSearch:K,onChange:t=>{const c=l.cloneDeep(s);c[i].styleId=(t==null?void 0:t.id)||"",c[i].style=t||"",c[i].category=(t==null?void 0:t.category)||"",c[i].categoryName=(t==null?void 0:t.categoryName)||"",a(c)},children:T.map(t=>r(y.Option,{value:t,children:t.styleCode},t.id))}),r(I,{style:{width:"25%"},type:"primary",onClick:()=>{k(e),O(!0)},children:"检索"})]})}},{title:"图片",dataIndex:"imgSrc",align:"center",render:(n,e,i)=>r(z,{url:e.imgSrc,onChange:o=>{var c,m;const t=l.cloneDeep(s);t[i].imgSrc=(m=(c=o[0])==null?void 0:c.response)==null?void 0:m.src,a(t)}})},{title:"圈号",dataIndex:"circle",align:"center",width:100,render:(n,e,i)=>r(g,{disabled:e.status===1,value:e.circle,onChange:o=>{const t=l.cloneDeep(s);t[i].circle=o,a(t)}})},{title:"件重",dataIndex:"singleWeight",align:"center",width:100,render:(n,e,i)=>r(E,{disabled:e.status===1,value:e.singleWeight,onChange:o=>{const t=l.cloneDeep(s);t[i].singleWeight=o,t[i].totalWeight=e.quantity&&o&&Number((Number(e.quantity)*Number(o)).toFixed(2)),a(t)}})},{title:"数量",dataIndex:"quantity",align:"center",width:100,render:(n,e,i)=>r(E,{disabled:e.status===1,value:e.quantity,onChange:o=>{const t=l.cloneDeep(s);t[i].quantity=o,t[i].totalWeight=o&&e.singleWeight&&Number((Number(o)*Number(e.singleWeight)).toFixed(2)),a(t)}})},{title:"状态",align:"center",dataIndex:"status",width:100,render:n=>h(j,{children:[n===0&&r(R,{color:"red",children:"未排产"}),n===1&&r(R,{color:"green",children:"已排产"})]})},{title:"总重",align:"center",dataIndex:"totalWeight",width:100},{title:"操作",align:"center",width:120,render:(n,e,i)=>r(I,{disabled:e.status===1,type:"text",onClick:()=>P(e.id,i),children:"删除"})}],P=async(n,e)=>{n&&await Y(n),a(s.filter((i,o)=>o!==e))},[q,b]=d.useState([]);return d.useEffect(()=>{b(u.map(n=>n.nanoid))},[u]),h(j,{children:[W&&r(J,{visible:W,style:x,onClose:n=>{const e=l.cloneDeep(x);e.styleId=(n==null?void 0:n.id)||"",e.style=n||"",e.category=(n==null?void 0:n.category)||"",e.categoryName=(n==null?void 0:n.categoryName)||"";const i=l.cloneDeep(s),o=i.find(t=>t.nanoid===e.nanoid);Object.assign(o,e),a(i),O(!1),k({})}}),r(L,{scroll:{y:window.screen.height-300},columns:G,data:s,pagination:!1,rowKey:"nanoid",rowSelection:{type:"checkbox",selectedRowKeys:q,onChange:(n,e)=>{b(n),C(e)},checkboxProps:n=>({disabled:!n.category||n.status===1})}})]})};export{Ne as default};
