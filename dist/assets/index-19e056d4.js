import{R as z,r as f,I as H,j as e,_ as J,F as j,G as M,d as C,l as P,g as U,a as y,S as V,B as v,h as D,m as I,p as Z,D as ee,n as q,M as te}from"./index-2fe9f87b.js";import{U as A}from"./index-a3018368.js";import"./index-ed7d1e53.js";import{D as re}from"./index-46012c63.js";import"./index-051f16ed.js";/* empty css              */import{S as p}from"./index-99f088e0.js";import{g as ae,u as oe,a as le}from"./service-735e5b75.js";import{b as ie}from"./service-1a26ac09.js";import ne from"./editableTable-b4514282.js";import{b as x,v as se}from"./common-26ce2b19.js";import{n as F}from"./index.browser-7e542916.js";import"./index-36185895.js";import"./index-6b64cf7e.js";import"./index-18b86337.js";import"./index-a8984739.js";import"./select-view-e3752154.js";import"./index-26e1abb8.js";import"./pictureUpload-b2c3a753.js";import"./rotate-c57d4b9d.js";import"./service-39d851c5.js";import"./findStyle-b646b788.js";import"./StyleFilter-967f201e.js";import"./index-1c0548d1.js";import"./scrollIntoView-eed899c1.js";import"./index-ed740d17.js";import"./form-de005383.js";import"./service-82e768f3.js";import"./index-5c024e38.js";import"./constants-filter-c5ec6bba.js";import"./image-d5b95c01.js";import"./edit-aacc2711.js";import"./index-e5c443e4.js";import"./mobileFilter-588aaca9.js";function B(r,s){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);s&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(r,c).enumerable})),l.push.apply(l,n)}return l}function _(r){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?B(Object(l),!0).forEach(function(n){J(r,n,l[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):B(Object(l)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(l,n))})}return r}function ce(r,s){var l=f.useContext(H),n=l.prefixCls,c=n===void 0?"arco":n,S=r.spin,u=r.className,h=_(_({"aria-hidden":!0,focusable:!1,ref:s},r),{},{className:"".concat(u?u+" ":"").concat(c,"-icon ").concat(c,"-icon-arrow-up")});return S&&(h.className="".concat(h.className," ").concat(c,"-icon-loading")),delete h.spin,delete h.isIcon,e("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...h,children:e("path",{d:"M11.27 20.272 23.997 7.544l12.728 12.728M24 43V8.705"})})}var E=z.forwardRef(ce);E.defaultProps={isIcon:!0};E.displayName="IconArrowUp";const de=E,m=j.Item,pe=M.Row,b=M.Col;function $e({data:r,onClose:s}){const[l]=j.useForm(),{data:n}=C(ie),{data:c,loading:S}=C(()=>r.id&&ae(r.id)),{data:u}=C(()=>P("FONT_PRINT")),{data:h}=C(()=>P("CATEGORY")),[G,k]=f.useState(!1),[g,w]=f.useState([]),[T,L]=f.useState([]),[d,O]=f.useState({type:"category",value:""}),R=()=>{let t=0,a=0;g.forEach(o=>{t+=Number(o==null?void 0:o.totalWeight),a+=Number(o==null?void 0:o.quantity)}),l.setFieldValue("orderTotalWeight",Number(t.toFixed(2))),l.setFieldValue("orderTotalQuantity",Number(a.toFixed(2)))};f.useEffect(()=>{r.id&&l.setFieldsValue({orderDate:U().format()})},[]),f.useEffect(()=>{c==null||c.forEach(t=>t.nanoid=F()),c&&w(c)},[c]),f.useEffect(()=>{R()},[g]);async function Q(){try{await l.validate();const t=l.getFieldsValue();t.charactersId&&(t.charactersTitle=u==null?void 0:u.find(i=>i.id===t.charactersId).title);const a=q.cloneDeep(g);a.forEach(i=>{i.orderId=r.id,delete i.nanoid,delete i.style});const o={orderData:t,orderDetailData:a};k(!0),r.id?await oe(r.id,o):await le(o),te.success("提交成功 !"),s()}catch{}finally{k(!1)}}const[$,K]=f.useState([]),X=()=>{const{type:t,value:a}=d,o=q.cloneDeep(g);o.forEach(i=>{T.find(N=>N.nanoid===i.nanoid)&&(i[t]=a,t==="category"&&(i.categoryName=h.find(N=>N.key===a).title),(t==="quantity"||t==="singleWeight")&&(i.totalWeight=i.quantity&&i.singleWeight&&Number((Number(i.quantity)*Number(i.singleWeight)).toFixed(2))),R())}),w(o)},W=t=>{const a=t.map(o=>{var i;return{imgSrc:((i=o==null?void 0:o.response)==null?void 0:i.src)||(o==null?void 0:o.src),nanoid:F(),category:"DEFAULT"}});L(a),w([...g,...a]),K([])},Y=y("div",{style:{display:"flex",justifyContent:"space-between"},children:[y(V,{children:[e(v,{type:"primary",onClick:()=>w([...g,{nanoid:F()}]),children:"新增"}),e(A,{action:"/api/upload/excel",showUploadList:!1,onChange:(t,a)=>{a.status==="done"&&W(a.response.children)},children:e(v,{icon:e(de,{}),children:"上传EXCEL"})}),e(A,{multiple:!0,fileList:$,action:"/api/upload/order",showUploadList:!1,onChange:t=>{t.filter(o=>o.status==="done").length===t.length&&W(t)}}),y("div",{style:{display:"flex"},children:[y(p,{value:d.type,showSearch:!0,placeholder:"请选择列",style:{marginRight:10,width:100},onChange:t=>O({type:t,value:""}),children:[e(p.Option,{value:"category",children:"品名"}),e(p.Option,{value:"circle",children:"圈号"}),e(p.Option,{value:"singleWeight",children:"件重"}),e(p.Option,{value:"quantity",children:"数量"})]}),d.type==="category"&&e(p,{placeholder:"请选择品名",style:{width:160},value:d.value,showSearch:!0,filterOption:x,onChange:t=>O({type:d.type,value:t}),children:h==null?void 0:h.map(t=>e(p.Option,{value:t.key,children:t.title},t.id))}),d.type==="circle"&&e(D,{value:d.value,placeholder:"值",style:{width:160},onChange:t=>O({type:d.type,value:t})}),d.type!=="circle"&&d.type!=="category"&&e(I,{value:d.value,placeholder:"值",style:{width:160},onChange:t=>O({type:d.type,value:t})}),e(v,{type:"primary",onClick:()=>X(),children:"分配"})]})]}),y(V,{children:[e(v,{onClick:s,children:"取消"}),e(v,{type:"primary",onClick:Q,children:"确定"})]})]});return e(Z,{tip:"加载中...",loading:S,children:y(ee,{height:"100%",placement:"bottom",title:r.id?"编辑":"新增",visible:!0,footer:Y,autoFocus:!1,focusLock:!1,onCancel:s,confirmLoading:G,children:[e(j,{labelCol:{span:6},wrapperCol:{span:17},form:l,initialValues:r.id&&r||{orderDate:U().toISOString()},validateMessages:se,children:y(pe,{className:"grid-demo",style:{marginBottom:16},children:[e(b,{span:6,children:e(m,{label:"客户名称",field:"customerId",rules:[{required:!0}],children:e(p,{placeholder:"请选择",allowClear:!0,showSearch:!0,filterOption:x,children:n==null?void 0:n.map(t=>e(p.Option,{value:t.id,children:t.name},t.id))})})}),e(b,{span:6,children:e(m,{label:"订单号",field:"orderNumber",children:e(D,{placeholder:"请输入订单号"})})}),y(b,{span:6,children:[e(m,{label:"字印",field:"fontPrint",children:e(p,{placeholder:"请选择",allowClear:!0,showSearch:!0,filterOption:x,onChange:(t,a)=>{l.setFieldValue("fontPrintName","children"in a?a==null?void 0:a.children:"")},children:u==null?void 0:u.map(t=>e(p.Option,{value:t.key,children:t.title},t.id))})}),e(m,{hidden:!0,label:"字印",field:"fontPrintName",children:e(D,{placeholder:"请输入字印",disabled:!0})})]}),e(b,{span:6,children:e(m,{label:"下单日期",field:"orderDate",children:e(re,{onChange:(t,a)=>l.setFieldValue("orderDate",a.toISOString()),placeholder:"请选择下单日期",style:{width:"100%"}})})}),e(b,{span:6,children:e(m,{label:"备注",field:"remark",children:e(D,{placeholder:"请输入备注"})})}),e(b,{span:6,children:e(m,{label:"总件数",field:"orderTotalQuantity",disabled:!0,children:e(I,{placeholder:"总件数"})})}),e(b,{span:6,children:e(m,{label:"总重",field:"orderTotalWeight",disabled:!0,children:e(I,{placeholder:"总重"})})})]})}),e(ne,{detailData:g,selectedRow:T,setDetailData:w,setSelectedRow:L})]})})}export{$e as default};
