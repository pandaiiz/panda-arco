import{G as V,r as C,a as O,j as e,h as n,f as I,F as k,d as y,o as S,m as _,M as D}from"./index-f50a7ad4.js";import"./index-f26404de.js";/* empty css              */import{S as o}from"./index-4a89bbe3.js";import{U as w}from"./index-9201017e.js";import"./index-862429a3.js";import{M}from"./index-2fd8deeb.js";import{u as R,b as x,c as B}from"./service-f9aa5ca4.js";import{v as q,f as b,p as v}from"./common-874ed4d1.js";import{g as G}from"./service-ad020438.js";import{T}from"./index-679f783d.js";import"./select-view-c7889b9d.js";import"./index-63a71a35.js";import"./index-025950e7.js";const j="_tag_7226e_1",N={tag:j,"add-tag":"_add-tag_7226e_4"},A=V.Row,F=V.Col;function H({tags:a,setTags:f}){const[t,c]=C.useState(!1),[u,p]=C.useState("");function m(){u&&(a=[...a,u],f(a),p("")),c(!1)}function g(d){const s=a.filter(h=>h!==d);f(s)}return O(A,{children:[a==null?void 0:a.map((d,s)=>e(F,{span:6,style:{marginBottom:10},children:e(T,{closable:s!==0,onClose:()=>g(d),className:N.tag,children:d})},d+s)),t?e(F,{span:6,children:e(n,{autoFocus:!0,size:"mini",value:u,className:N.tag,onPressEnter:m,onBlur:m,onChange:p})}):e(F,{span:6,children:e(T,{icon:e(I,{}),className:N["add-tag"],tabIndex:0,onClick:()=>c(!0),onKeyDown:d=>{(d.keyCode||d.which)===13&&c(!0)},children:"新增"})})]})}const i=k.Item;function ae({data:a,onClose:f}){var P;const[t]=k.useForm(),[c,u]=C.useState([]),{data:p}=y(()=>S("CATEGORY")),{data:m}=y(()=>S("SPEC")),{data:g}=y(()=>S("TECH")),{data:d}=y(()=>G("PROGRAM"));C.useEffect(()=>{a.id&&u(JSON.parse(a.tags)||[])},[]);async function s(){await t.validate();const l=t.getFieldsValue(),r=_.cloneDeep(l);delete r.programmerCode,r.tags=JSON.stringify(c),v(r,"designSrc"),v(r,"realitySrc"),v(r,"programSrc"),a.id?await R(a.id,r):await x(r),D.success("提交成功 !"),f()}async function h(){const l=t.getFieldsValue();if(!l.programmerCode||!l.specName||!l.techName||!l.categoryName)return;const r=l.category+l.programmerCode+l.spec+l.tech,E=await B(r);t.setFieldValue("baseStyleCode",r),t.setFieldValue("styleCode",`${r}-${E.length+1}`)}return e("div",{children:e(M,{title:a.id?"编辑":"新增",visible:!0,onOk:s,autoFocus:!1,focusLock:!1,onCancel:f,children:O(k,{labelCol:{span:5},wrapperCol:{span:17},form:t,initialValues:a.id?a:{enabled:!0,breadcrumb:!0},validateMessages:q,children:[e(i,{label:"品名",field:"category",rules:[{required:!0}],children:e(o,{disabled:a.id,placeholder:"请选择品名",showSearch:!0,filterOption:b,onChange:(l,r)=>{t.setFieldValue("categoryName","children"in r?r.children:""),h()},children:p==null?void 0:p.map(l=>e(o.Option,{value:l.key,children:l.title},l.id))})}),e(i,{label:"品名",field:"categoryName",hidden:!0,children:e(n,{})}),e(i,{label:"规格",field:"spec",rules:[{required:!0}],children:e(o,{disabled:a.id,placeholder:"请选择规格",showSearch:!0,filterOption:b,onChange:(l,r)=>{t.setFieldValue("specName","children"in r?r.children:""),h()},children:m==null?void 0:m.map(l=>e(o.Option,{value:l.key,children:l.title},l.id))})}),e(i,{label:"规格",field:"specName",hidden:!0,children:e(n,{})}),e(i,{label:"工艺",field:"tech",rules:[{required:!0}],children:e(o,{disabled:a.id,placeholder:"请选择工艺",showSearch:!0,filterOption:b,onChange:(l,r)=>{t.setFieldValue("techName","children"in r?r.children:""),h()},children:g==null?void 0:g.map(l=>e(o.Option,{value:l.key,children:l.title},l.id))})}),e(i,{label:"工艺",field:"techName",hidden:!0,children:e(n,{})}),e(i,{disabled:a.id,label:"编程",field:"programmerId",children:e(o,{placeholder:"请选择编程",showSearch:!0,filterOption:b,onChange:(l,r)=>{t.setFieldValue("programmerCode","_key"in r?r._key:""),h()},children:(P=d==null?void 0:d.users)==null?void 0:P.map(l=>e(o.Option,{value:l.id,children:l.name},l.code))})}),e(i,{label:"编程",field:"programmerCode",hidden:!0,children:e(n,{})}),e(i,{hidden:!0,label:"基础款号",field:"baseStyleCode",children:e(n,{placeholder:"基础款号自动生成"})}),e(i,{label:"款号",field:"styleCode",children:e(n,{disabled:!0,placeholder:"款号自动生成"})}),e(i,{label:"备注",field:"remark",children:e(n,{placeholder:"备注"})}),e(i,{label:"设计图",field:"designSrc",triggerPropName:"fileList",children:e(w,{listType:"picture-card",imagePreview:!0,multiple:!0,action:"/api/picture/upload",limit:1})}),e(i,{label:"编程图",field:"programSrc",triggerPropName:"fileList",children:e(w,{listType:"picture-card",multiple:!0,imagePreview:!0,action:"/api/picture/upload",limit:1})}),e(i,{label:"实拍图",field:"realitySrc",triggerPropName:"fileList",children:e(w,{listType:"picture-card",multiple:!0,imagePreview:!0,action:"/api/picture/upload",limit:1})}),e(i,{label:"标签",field:"contactsPhone",children:e(H,{tags:c,setTags:u})})]})})})}export{ae as default};
