import{d as f,l as v,r as d,a as h,S as x,j as o,B as g,h as T,m as H,D as Y,n as R,M as z}from"./index-2fe9f87b.js";import{U as J}from"./index-a3018368.js";import"./index-ed7d1e53.js";import"./index-051f16ed.js";/* empty css              */import{S as l}from"./index-99f088e0.js";import K from"./editableTable-40ae939d.js";import{f as C,a as b,b as Q}from"./common-26ce2b19.js";import{n as U}from"./index.browser-7e542916.js";import{g as V}from"./service-82e768f3.js";import{b as X}from"./service-39d851c5.js";import"./index-36185895.js";import"./index-6b64cf7e.js";import"./select-view-e3752154.js";import"./index-26e1abb8.js";import"./index-18b86337.js";import"./index-a8984739.js";import"./service-735e5b75.js";import"./pictureUpload-f4b426bf.js";import"./rotate-c57d4b9d.js";function Se({onClose:S}){const{data:c}=f(()=>v("CATEGORY")),{data:q}=f(()=>v("SPEC")),{data:B}=f(()=>v("TECH")),{data:F}=f(()=>V("PROGRAM")),[W,j]=d.useState(!1),[i,u]=d.useState([]),[m,w]=d.useState([]),[r,y]=d.useState({type:"category",value:""});async function A(){try{const t=R.cloneDeep(i);t.forEach(a=>{a.realitySrc=[{name:a==null?void 0:a.picName,uid:a==null?void 0:a.picUid,url:a==null?void 0:a.realitySrc}],delete a.picName,delete a.picUid,delete a.nanoid}),await X(t),z.success("提交成功 !"),S()}catch{}finally{j(!1)}}const[I,M]=d.useState([]),G=()=>{const{type:t,value:a}=r,p=R.cloneDeep(i);p.forEach(e=>{m.find(n=>n.nanoid===e.nanoid)&&(e[t]=a,t==="category"&&(e.categoryName=c.find(n=>n.key===a).title),(t==="quantity"||t==="singleWeight")&&(e.totalWeight=e.quantity&&e.singleWeight&&Number((Number(e.quantity)*Number(e.singleWeight)).toFixed(2))))}),u(p)},P=h("div",{style:{display:"flex",justifyContent:"space-between"},children:[h(x,{children:[o(g,{type:"primary",onClick:()=>u([...i,{nanoid:U()}]),children:"新增"}),o(J,{multiple:!0,fileList:I,action:"/api/upload/image",showUploadList:!1,onChange:t=>{if(t.filter(e=>e.status==="done").length!==t.length)return;const p=t.map(e=>{var D,N,k,E,L,O;const n=e==null?void 0:e.name.split("-")[0];return console.log(C(n)),{realitySrc:(D=e==null?void 0:e.response)==null?void 0:D.src,picUid:(N=e==null?void 0:e.response)==null?void 0:N.uid,picName:(k=e==null?void 0:e.response)==null?void 0:k.name,category:C(n),categoryName:(E=c.find(s=>s.key===C(n).toString()))==null?void 0:E.title,programmerId:F.users.find(s=>s.code===b(n)[0].toString()).id,spec:b(n).slice(1,-2),specName:(L=q.find(s=>s.key===b(n).slice(1,-2).toString()))==null?void 0:L.title,tech:n.slice(-2),techName:(O=B.find(s=>s.key===n.slice(-2).toString()))==null?void 0:O.title,styleCode:e==null?void 0:e.name.split(".")[0],baseStyleCode:n,nanoid:U()}});w(p),u([...i,...p]),M([])}}),h("div",{style:{display:"flex"},children:[h(l,{value:r.type,showSearch:!0,placeholder:"请选择列",style:{marginRight:10,width:100},onChange:t=>y({type:t,value:""}),children:[o(l.Option,{value:"category",children:"品名"}),o(l.Option,{value:"circle",children:"圈号"}),o(l.Option,{value:"singleWeight",children:"件重"}),o(l.Option,{value:"quantity",children:"数量"})]}),r.type==="category"&&o(l,{placeholder:"请选择品名",style:{width:160},value:r.value,showSearch:!0,filterOption:Q,onChange:t=>y({type:r.type,value:t}),children:c==null?void 0:c.map(t=>o(l.Option,{value:t.key,children:t.title},t.id))}),r.type==="circle"&&o(T,{value:r.value,placeholder:"值",style:{width:160},onChange:t=>y({type:r.type,value:t})}),r.type!=="circle"&&r.type!=="category"&&o(H,{value:r.value,placeholder:"值",style:{width:160},onChange:t=>y({type:r.type,value:t})}),o(g,{type:"primary",onClick:()=>G(),children:"分配"})]})]}),h(x,{children:[o(g,{onClick:S,children:"取消"}),o(g,{type:"primary",onClick:A,children:"确定"})]})]});return o(Y,{height:"100%",placement:"bottom",title:"批量新增款式",visible:!0,footer:P,autoFocus:!1,focusLock:!1,onCancel:S,confirmLoading:W,children:o(K,{detailData:i,selectedRow:m,setDetailData:u,setSelectedRow:w})})}export{Se as default};
