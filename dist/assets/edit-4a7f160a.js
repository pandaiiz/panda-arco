import{a4 as J,Y as X,r as v,aA as fe,b1 as pe,as as Re,a7 as Ae,C as Ve,ac as De,c as oe,w as W,ag as Le,a as Te,j as h,u as Ee,U as Fe,q as me,ai as Ke,aB as Me,v as He,an as je,F as ce,d as We,M as Ce,h as le,n as $e,aX as ie,m as Ue}from"./index-f50a7ad4.js";import"./index-f26404de.js";import{g as qe,T as A,a as ze,b as Be,c as Ge,u as Je,d as Xe}from"./service-463b3e3e.js";import{M as Ye}from"./index-2fd8deeb.js";import{v as Qe}from"./common-874ed4d1.js";import{S as Ze}from"./select-view-c7889b9d.js";import"./index-025950e7.js";import"./scrollIntoView-e2cb9fcb.js";import"./index-679f783d.js";var Z=function(e){var n=e;return J(e)||(n=e==null?[]:[e]),n.map(function(r){return X(r)?r.value:r})},G=globalThis&&globalThis.__assign||function(){return G=Object.assign||function(e){for(var n,r=1,l=arguments.length;r<l;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},G.apply(this,arguments)},er=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var l=r.call(e),i,t=[],c;try{for(;(n===void 0||n-- >0)&&!(i=l.next()).done;)t.push(i.value)}catch(a){c={error:a}}finally{try{i&&!i.done&&(r=l.return)&&r.call(l)}finally{if(c)throw c.error}}return t},ee=function(e,n,r){if(e==null)return[];var l=J(e)?e:[e];return l.map(function(i){var t=X(i)?G({},i):{value:i,label:void 0},c=n[t.value];if(c)t.label=t.label||c.title,t.disabled=c.disabled;else if(J(r)){var a=r.find(function(y){return y.value===t.value});t=G(G({},t),a)}return Re(t.label)&&(t.label=t.value),t})},rr=function(e,n,r,l){if(!l.treeCheckStrictly){var i=qe(e,n),t=i.checkedKeys,c=i.indeterminateKeys,a=t;return r.current=c,l.treeCheckedStrategy===A.SHOW_PARENT?a=a.filter(function(y){var u=n[y];if(!u||a.indexOf(u.parentKey)===-1)return!0}):l.treeCheckedStrategy===A.SHOW_CHILD&&(a=a.filter(function(y){var u=n[y];if(!u||!u.children||!u.children.length)return!0})),a}return r.current=[],e},tr=function(e,n,r){var l=v.useRef([]),i=function(){var s=e.value||e.defaultValue||[];if(e.treeCheckable){var b=rr(Z(s),n,r,e),p=ee(s,n,l.current),T=ee(b,n,p);return T}return ee(s,n)},t=er(v.useState(i),2),c=t[0],a=t[1],y=function(s){l.current=s,a(s)};fe(function(){var s=i();"value"in e&&(e.labelInValue?pe(Z(c),Z(s))||y(s):pe(c,s)||y(s))},[e.treeCheckedStrategy,e.treeCheckStrictly,e.treeCheckable,e.value,n]);var u=v.useCallback(function(s,b){var p=e.onChange,T=e.labelInValue,x=e.multiple||e.treeCheckable;"value"in e||y(s);var m;x?m=s.map(function(D){return T?{label:D.label,value:D.value}:D.value}):m=T?s[0]:s[0]&&s[0].value,p&&p(m,b)},[e.onChange,e.labelInValue,e.multiple,e.treeCheckable,e.value]);return[c,u]};const ar=tr;var we={key:"key",title:"title",children:"children",selectable:"selectable",disabled:"disabled",disableCheckbox:"disableCheckbox",checkable:"checkable",isLeaf:"isLeaf"},nr=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var l=r.call(e),i,t=[],c;try{for(;(n===void 0||n-- >0)&&!(i=l.next()).done;)t.push(i.value)}catch(a){c={error:a}}finally{try{i&&!i.done&&(r=l.return)&&r.call(l)}finally{if(c)throw c.error}}return t};function lr(e){var n=Ae(e)||{},r=function(){return e.treeData||ze(e.children)},l=nr(v.useState(r()),2),i=l[0],t=l[1];return fe(function(){(e.treeData!==n.treeData||e.children!==n.children)&&t(r())},[e]),[i]}var $=globalThis&&globalThis.__assign||function(){return $=Object.assign||function(e){for(var n,r=1,l=arguments.length;r<l;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},$.apply(this,arguments)},ir=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var l=r.call(e),i,t=[],c;try{for(;(n===void 0||n-- >0)&&!(i=l.next()).done;)t.push(i.value)}catch(a){c={error:a}}finally{try{i&&!i.done&&(r=l.return)&&r.call(l)}finally{if(c)throw c.error}}return t},ke=globalThis&&globalThis.__spreadArray||function(e,n,r){if(r||arguments.length===2)for(var l=0,i=n.length,t;l<i;l++)(t||!(l in n))&&(t||(t=Array.prototype.slice.call(n,0,l)),t[l]=n[l]);return e.concat(t||Array.prototype.slice.call(n))},_e=function(e,n,r){var l={},i=0,t=function(c,a){var y=c.length;return c.map(function(u,s){var b=u[r.children],p=r.key in u?u[r.key]:((a==null?void 0:a._key)||"")+"-"+s,T=$($({},u),{title:u[r.title],selectable:u[r.selectable],disabled:u[r.disabled],disableCheckbox:u[r.disableCheckbox],checkable:u[r.checkable],isLeaf:u[r.isLeaf],key:p,children:b,_key:p,parentKey:a?a._key:void 0,pathParentKeys:a&&a.pathParentKeys||[],_level:a._level||0,_index:i++});return y===s+1&&(T.className=oe(n+"-node-is-tail",T.className)),l[p]=T,b&&b.length&&(l[p].children=t(b,{_key:p,_level:T._level+1,pathParentKeys:ke(ke([],ir((a==null?void 0:a.pathParentKeys)||[]),!1),[p],!1)})),T})};return t(e||[],{}),l},ur=function(e,n){var r=v.useContext(Ve).getPrefixCls,l=$($({},we),n),i=De(),t=r("tree"),c=v.useRef(_e(e,t,l));return fe(function(){c.current=_e(e,t,l),i()},[e]),c.current};const or=ur;var se=globalThis&&globalThis.__assign||function(){return se=Object.assign||function(e){for(var n,r=1,l=arguments.length;r<l;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},se.apply(this,arguments)},cr=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var l=r.call(e),i,t=[],c;try{for(;(n===void 0||n-- >0)&&!(i=l.next()).done;)t.push(i.value)}catch(a){c={error:a}}finally{try{i&&!i.done&&(r=l.return)&&r.call(l)}finally{if(c)throw c.error}}return t},sr=globalThis&&globalThis.__spreadArray||function(e,n,r){if(r||arguments.length===2)for(var l=0,i=n.length,t;l<i;l++)(t||!(l in n))&&(t||(t=Array.prototype.slice.call(n,0,l)),t[l]=n[l]);return e.concat(t||Array.prototype.slice.call(n))};function fr(e,n){var r=e.value,l=e.multiple,i=e.loadMore,t=e.treeCheckedStrategy,c=e.treeCheckStrictly,a=e.treeData,y=e.treeProps,u=e.prefixCls,s=e.treeCheckable,b=y&&y.renderTitle,p=v.useRef(),T=v.useCallback(function(k,g){var d=g.checkedNodes,I=g.checked,C=g.node,P=k.map(function(O){var R=d.find(function(L){return L&&L.props._key===O});if(!R){var V=r.find(function(L){return L.value===O});return V||{label:O,value:O}}return{label:R.props.title,value:R.props._key,disabled:R.props.disabled}});e.onChange(P,{checked:I,trigger:C==null?void 0:C.props})},[e.onChange,r]),x=v.useCallback(function(k,g){var d=g.node,I=g.selected,C=[{value:d.props._key,label:d.props.title}];if(l){C=sr([],cr(r),!1);var P=C.findIndex(function(O){return O.value===d.props._key});P>-1?C.splice(P,1):C.push({value:d.props._key,label:d.props.title})}e.onChange(C,{trigger:d==null?void 0:d.props,selected:I})},[e.onChange,r,l]),m=v.useCallback(function(k,g){var d=g.node,I=g.e,C=d.props,P=C.checked,O=C.checkable,R=C.disabled,V=C.disableCheckbox;p.current&&!V&&!R&&O!==!1&&p.current.handleCheck&&p.current.handleCheck(!P,d.props._key,I)},[]),D=v.useCallback(function(k){if(W(i)){var g=k.props.dataRef;return i(k,g)}return[]},[i]),q=v.useCallback(function(k){if(b)return b(k);var g=e.inputValue,d=k.title;if(g&&Le(d)){var I=d.toLowerCase().indexOf(g.toLowerCase());if(I===-1)return d;var C=d.substr(0,I),P=d.substr(I+g.length);return Te("span",{children:[C,h("span",{className:u+"-highlight",children:d.substr(I,g.length)}),P]})}return d},[u,e.inputValue,b]),re=v.useMemo(function(){return e.treeCheckable?{onCheck:T,checkedKeys:r.map(function(k){return k.value})}:{}},[T,r,e.treeCheckable]),Y=v.useMemo(function(){return e.treeCheckable?[]:r.map(function(k){return k.value})},[e.treeCheckable,r]),N=v.useCallback(function(k,g){e.treeCheckable?m(k,g):x(k,g)},[e.treeCheckable,m,x]);return v.useImperativeHandle(n,function(){return p.current},[]),h(A,{...se({ref:p,size:e.size,blockNode:!0,filterNode:e.filterNode},y,{checkable:s,multiple:l,loadMore:e.loadMore?D:void 0,checkedStrategy:t,checkStrictly:c,onMouseDown:function(k){k.preventDefault()}},re,{treeData:a,fieldNames:e.fieldNames,renderTitle:q,onSelect:N,selectedKeys:Y})})}const dr=v.forwardRef(fr);var M=globalThis&&globalThis.__assign||function(){return M=Object.assign||function(e){for(var n,r=1,l=arguments.length;r<l;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},M.apply(this,arguments)},vr=globalThis&&globalThis.__awaiter||function(e,n,r,l){function i(t){return t instanceof r?t:new r(function(c){c(t)})}return new(r||(r=Promise))(function(t,c){function a(s){try{u(l.next(s))}catch(b){c(b)}}function y(s){try{u(l.throw(s))}catch(b){c(b)}}function u(s){s.done?t(s.value):i(s.value).then(a,y)}u((l=l.apply(e,n||[])).next())})},hr=globalThis&&globalThis.__generator||function(e,n){var r={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},l,i,t,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(u){return function(s){return y([u,s])}}function y(u){if(l)throw new TypeError("Generator is already executing.");for(;r;)try{if(l=1,i&&(t=u[0]&2?i.return:u[0]?i.throw||((t=i.return)&&t.call(i),0):i.next)&&!(t=t.call(i,u[1])).done)return t;switch(i=0,t&&(u=[u[0]&2,t.value]),u[0]){case 0:case 1:t=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(t=r.trys,!(t=t.length>0&&t[t.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!t||u[1]>t[0]&&u[1]<t[3])){r.label=u[1];break}if(u[0]===6&&r.label<t[1]){r.label=t[1],t=u;break}if(t&&r.label<t[2]){r.label=t[2],r.ops.push(u);break}t[2]&&r.ops.pop(),r.trys.pop();continue}u=n.call(e,r)}catch(s){u=[6,s],i=0}finally{l=t=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},j=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var l=r.call(e),i,t=[],c;try{for(;(n===void 0||n-- >0)&&!(i=l.next()).done;)t.push(i.value)}catch(a){c={error:a}}finally{try{i&&!i.done&&(r=l.return)&&r.call(l)}finally{if(c)throw c.error}}return t},Se=globalThis&&globalThis.__spreadArray||function(e,n,r){if(r||arguments.length===2)for(var l=0,i=n.length,t;l<i;l++)(t||!(l in n))&&(t||(t=Array.prototype.slice.call(n,0,l)),t[l]=n[l]);return e.concat(t||Array.prototype.slice.call(n))};function ue(e){return!e||J(e)&&e.length===0||X(e)&&Object.keys(e).length===0}var br={bordered:!0,treeCheckedStrategy:A.SHOW_CHILD,fieldNames:we},gr=function(e,n){var r=v.useContext(Ve),l=r.getPrefixCls,i=r.renderEmpty,t=r.componentConfig,c=r.rtl,a=Ee(e,br,t==null?void 0:t.TreeSelect),y=Fe(),u=v.useRef(),s=v.useRef(null),b=v.useRef(null),p=v.useRef([]),T=j(lr(a),1),x=T[0],m=or(x,a.fieldNames),D=j(v.useState(),2),q=D[0],re=D[1],Y=j(me(!1,{value:a.popupVisible}),2),N=Y[0],k=Y[1],g=j(me(void 0,{value:"inputValue"in a?a.inputValue||"":void 0}),2),d=g[0],I=g[1],C=v.useRef(d),P=v.useRef(null),O=a.onInputValueChange,R=j(ar(a,m,p),2),V=R[0],L=R[1],z=a.multiple||a.treeCheckable,H=l("tree-select"),te=d&&!W(a.onSearch),de=Ke(H+"-popup-"),ve=function(o){var f;o!==N&&(k(o),(f=a.onVisibleChange)===null||f===void 0||f.call(a,o))},ae=function(o,f){(o!==C.current||f!==P.current)&&(I(o),C.current=o,P.current=f,O&&O(o,f))},Ie=v.useCallback(function(o){var f=Me(function(S){return vr(void 0,void 0,void 0,function(){var _;return hr(this,function(w){switch(w.label){case 0:return W(a.onSearch)?[4,a.onSearch(S)]:[3,2];case 1:return w.sent(),[2];case 2:return S?(_=new Set,Object.keys(m).forEach(function(K){var E=m[K],B=!1;if(W(a.filterTreeNode))a.filterTreeNode(S,h(A.Node,{...M({},E)}))&&(B=!0);else{var ye=E.value||E._key;ye&&ye.indexOf(S)>-1&&(B=!0)}B&&_.add(E.key)}),re(_),[2]):[2,x]}})})},100);return f(o)},[a.onSearch,x,m,a.filterTreeNode]),he=v.useCallback(function(){var o=!0;X(a.showSearch)&&(o=a.showSearch.retainInputValueWhileSelect!==!1),a.multiple&&!o&&d!==void 0&&ae("","optionChecked")},[d,a.multiple,JSON.stringify(a.showSearch)]),Q=v.useCallback(function(o,f){L(o,f),he(),z||ve(!1)},[L,he,N]),Pe=function(o,f,S){if(S.stopPropagation(),!o.disabled){var _=X(o.value)?o.value.value:o.value;if(!a.treeCheckable||a.treeCheckStrictly||!m[_]){var w=V.filter(function(E,B){return B!==f});Q(w,{trigger:m[_]||o,checked:!1,selected:!1});return}var K=Be(_,!1,Z(V),m,p.current);p.current=K.indeterminateKeys,Q(ee(K.checkedKeys,m,V),{trigger:m[_],checked:!1,selected:!1})}};v.useEffect(function(){d!==void 0&&Ie(d),d!==C.current&&(C.current=d)},[d]);var ne=v.useMemo(function(){var o=[];if(d)for(var f in m){var S=m[f],_=Se(Se([],j(S.pathParentKeys),!1),[f],!1);_.some(function(w){return q&&q.has(w)})&&(o=o.concat(_))}return Array.from(new Set(o))},[d,m,q]);v.useEffect(function(){N?setTimeout(function(){var o=V[0];s.current&&o&&s.current.scrollIntoView(o.value)}):y||d&&ae("","optionListHide")},[N]),v.useImperativeHandle(n,function(){return{focus:function(){b.current&&b.current.focus()},blur:function(){b.current&&b.current.blur()}}});var Oe=v.useCallback(function(o){return te?ne.indexOf(o._key)>-1:!0},[te,ne]),xe=v.useCallback(function(o){var f=o||{},S=f.disabled,_=f.value,w=o==null?void 0:o.label;return W(a.renderFormat)&&(w=a.renderFormat(m[_]||null,a.labelInValue?o:_)),{text:w||_||"",disabled:S}},[a.renderFormat,a.labelInValue,m]),Ne=function(o){L(o,{})},be=function(o){return h(je,{...M({autoAlignPopupWidth:!1,autoAlignPopupMinWidth:!0,ref:u,classNames:"slideDynamicOrigin",trigger:"click",position:"bl",getPopupContainer:a.getPopupContainer,popupAlign:{bottom:4},unmountOnExit:a.unmountOnExit},a.triggerProps,{className:oe(H+"-trigger",a.triggerProps&&a.triggerProps.className),popup:function(){var f,S,_,w,K=a.dropdownRender,E=te&&ue(ne)||ue(x)?a.notFoundContent||i("TreeSelect"):h(dr,{...M({prefixCls:H,ref:s},a,{inputValue:d,filterNode:Oe,value:V,onChange:Q,multiple:z,treeData:x})});return h("div",{id:de,className:oe(H+"-popup",(f={},f[H+"-rtl-popup"]=c,f)),style:M({maxHeight:!((S=a.treeProps)===null||S===void 0)&&S.height||!((w=(_=a.treeProps)===null||_===void 0?void 0:_.virtualListProps)===null||w===void 0)&&w.height?"unset":""},a.dropdownMenuStyle),children:W(K)?K(E):E})},disabled:a.disabled,onVisibleChange:function(f){ve(f)},popupVisible:N}),children:o})},ge=typeof a.triggerElement=="function"?function(){var o,f;return z?f=V.map(function(S){return a.labelInValue?{label:S.label,value:S.value}:S.value}):f=a.labelInValue?V[0]:(o=V[0])===null||o===void 0?void 0:o.value,a.triggerElement({value:f})}():a.triggerElement;return He(ge)?h(Ze,{...M({ref:b,rtl:c,ariaControls:de},a,{popupVisible:N,value:!z&&J(V)?V[0]:V,inputValue:d,isEmptyValue:ue(V),prefixCls:H,isMultiple:z,renderText:xe,onSort:Ne,onRemoveCheckedItem:Pe,onClear:function(o){var f;o.stopPropagation(),Q([],{}),(f=a.onClear)===null||f===void 0||f.call(a,!!N)},onKeyDown:function(o){var f;o.stopPropagation(),(f=a.onKeyDown)===null||f===void 0||f.call(a,o)},onFocus:function(o){o&&o.stopPropagation()},onChangeInputValue:function(o){ae(o,"manual")},renderView:be})}):be(ge)},yr=v.forwardRef(gr),U=yr;U.displayName="TreeSelect";U.Node=A.Node;U.SHOW_ALL=A.SHOW_ALL;U.SHOW_PARENT=A.SHOW_PARENT;U.SHOW_CHILD=A.SHOW_CHILD;const pr=U;const F=ce.Item;function Pr({data:e,onClose:n}){const[r]=ce.useForm(),{data:l,loading:i}=We(Ge);v.useEffect(()=>{e.id||r.setFieldsValue({enabled:1,sort:0})},[]);async function t(){await r.validate();const c=r.getFieldsValue(),a=Ue.cloneDeep(c);a.enabled=a.enabled?1:0,e.id?await Je(e.id,a):await Xe(a),Ce.success("提交成功 !"),n()}return h("div",{children:h(Ye,{title:e.id?"编辑":"新增",visible:!0,onOk:t,autoFocus:!1,focusLock:!1,onCancel:n,confirmLoading:i,children:Te(ce,{labelCol:{span:5},wrapperCol:{span:17},form:r,initialValues:e.id?e:{enabled:!0,breadcrumb:!0},validateMessages:Qe,children:[h(F,{label:"上级节点",field:"parentId",children:h(pr,{placeholder:"请选择上级节点",treeData:l,allowClear:!0,fieldNames:{key:"id"},onChange:c=>{c===e.id&&(Ce.error("不能选择自己作为上级节点！"),r.setFieldsValue({parentId:e.parentId}))}})}),h(F,{label:"名称",field:"title",rules:[{required:!0}],children:h(le,{placeholder:"请输入菜单名称"})}),h(F,{label:"地址",field:"key",rules:[{required:!0}],children:h(le,{placeholder:"请输入菜单地址"})}),h(F,{label:"排序",field:"sort",rules:[{required:!0}],children:h($e,{min:0,defaultValue:0,step:1,precision:0})}),h(F,{label:"备注",field:"remark",children:h(le,{placeholder:"请输入备注"})}),h(F,{label:"启用",field:"enabled",triggerPropName:"checked",disabled:!e.parentId,children:h(ie,{})}),h(F,{tooltip:"当前页是否展示面包屑。",label:"面包屑",field:"breadcrumb",triggerPropName:"checked",children:h(ie,{})}),h(F,{tooltip:"当前路由是否渲染菜单项，为 true 的话不会在菜单中显示，但可通过路由地址访问。",label:"不渲染",field:"ignore",triggerPropName:"checked",children:h(ie,{})})]})})})}export{Pr as default};
