import{F as D,G as E,d as f,l as S,r as s,g as G,j as e,p as L,a as d,D as N,h as g,S as F,B as x,M as A,n as V}from"./index-2fe9f87b.js";import{D as H}from"./index-46012c63.js";import"./index-051f16ed.js";/* empty css              */import{S as r}from"./index-99f088e0.js";import{g as T,u as K,a as P}from"./service-735e5b75.js";import{b as W}from"./service-1a26ac09.js";import _ from"./editableTable-b4514282.js";import{s as $}from"./index.module-c4e1ad75.js";import"./index-18b86337.js";import"./index-a8984739.js";import"./select-view-e3752154.js";import"./index-26e1abb8.js";import"./pictureUpload-b2c3a753.js";import"./index-a3018368.js";import"./index-36185895.js";import"./index-ed7d1e53.js";import"./index-6b64cf7e.js";import"./index.browser-7e542916.js";import"./rotate-c57d4b9d.js";import"./service-39d851c5.js";import"./findStyle-b646b788.js";import"./StyleFilter-967f201e.js";import"./index-1c0548d1.js";import"./scrollIntoView-eed899c1.js";import"./index-ed740d17.js";import"./form-de005383.js";import"./common-26ce2b19.js";import"./service-82e768f3.js";import"./index-5c024e38.js";import"./constants-filter-c5ec6bba.js";import"./image-d5b95c01.js";import"./edit-aacc2711.js";import"./index-e5c443e4.js";import"./mobileFilter-588aaca9.js";const c=D.Item,z=E.Row,p=E.Col;function Me({data:a,onClose:w}){const[m]=D.useForm(),{data:b}=f(W),{data:v,loading:R}=f(()=>T(a.id)),{data:h}=f(()=>S("MARKING")),{data:y}=f(()=>S("CATEGORY")),[M,C]=s.useState(!1),[n,u]=s.useState([]),[k,B]=s.useState([]),[i,O]=s.useState({type:"circle",number:""});s.useEffect(()=>{a.id&&m.setFieldsValue({orderDate:G().format()})},[]),s.useEffect(()=>{u(v)},[v]);async function Y(){try{await m.validate();const t=m.getFieldsValue();t.charactersTitle=h.find(o=>o.id===t.charactersId).title;const l={orderData:t,orderDetailData:n};n.forEach(o=>delete o.orderId),C(!0),a.id?await K(a.id,l):await P(l),A.success("提交成功 !"),w()}catch{}finally{C(!1)}}const j=()=>{const{type:t,number:l}=i,o=V.cloneDeep(n);o.forEach(I=>{k.find(q=>q.id===I.id)&&(I[t]=l)}),u(o)};return e(L,{tip:"加载中...",loading:R,children:d(N,{height:"100%",placement:"bottom",title:a.id?"编辑":"新增",visible:!0,onOk:Y,autoFocus:!1,focusLock:!1,onCancel:w,confirmLoading:M,children:[e(D,{labelCol:{span:6},wrapperCol:{span:17},form:m,initialValues:a.id?a:{enabled:!0,breadcrumb:!0},validateMessages:{required:(t,{label:l})=>`必须填写${l}`,string:{length:"字符数必须是 #{length}",match:"不匹配正则 #{pattern}"},number:{min:"最小值为 #{min}",max:"最大值为 #{max}"}},children:d(z,{className:"grid-demo",style:{marginBottom:16},children:[e(p,{span:8,children:e(c,{label:"客户名称",field:"customerId",rules:[{required:!0}],children:e(r,{placeholder:"请选择",allowClear:!0,children:b==null?void 0:b.map(t=>e(r.Option,{value:t.id,children:t.name},t.id))})})}),e(p,{span:8,children:e(c,{label:"订单号",field:"orderNumber",children:e(g,{placeholder:"请输入订单号"})})}),e(p,{span:8,children:e(c,{label:"字印",field:"charactersId",children:e(r,{placeholder:"请选择",allowClear:!0,children:h==null?void 0:h.map(t=>e(r.Option,{value:t.id,children:t.title},t.id))})})}),e(p,{span:8,children:e(c,{label:"下单日期",field:"orderDate",children:e(H,{format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择下单日期",style:{width:"100%"}})})}),e(p,{span:8,children:e(c,{label:"备注",field:"remark",children:e(g,{placeholder:"请输入备注"})})})]})}),d("div",{className:$["button-group"],children:[e(F,{children:e(x,{type:"primary",onClick:()=>u([...n,{}]),children:"新增"})}),e(F,{children:d("div",{style:{display:"flex"},children:[d(r,{value:i.type,showSearch:!0,placeholder:"请选择列",style:{marginRight:10,width:100},onChange:t=>O({type:t,number:i.number}),children:[e(r.Option,{value:"circle",children:"圈号"}),e(r.Option,{value:"singleWeight",children:"件重"}),e(r.Option,{value:"quantity",children:"数量"}),e(r.Option,{value:"categoryId",children:"品名"})]}),i.type==="categoryId"?e(r,{placeholder:"请选择品名",allowClear:!0,value:i.number,children:y==null?void 0:y.map(t=>e(r.Option,{value:t.id,children:t.title},t.id))}):e(g,{value:i.number,placeholder:"值",style:{width:100},onChange:t=>O({type:i.type,number:t})}),e(x,{type:"primary",onClick:()=>j(),children:"分配"})]})})]}),e(_,{detailData:n,setDetailData:u,setSelectedRow:B})]})})}export{Me as default};
