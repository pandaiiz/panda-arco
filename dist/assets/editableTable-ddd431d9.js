import{r as d,m as l,d as U,o as V,a as h,k as j,j as r,h as g,B as I,p as A,n as E}from"./index-f50a7ad4.js";/* empty css              */import"./index-f26404de.js";import{S as y}from"./index-4a89bbe3.js";import{T as L}from"./index-13195c7d.js";import"./index-6dc1a68d.js";import{d as Y}from"./service-76aca5fa.js";import z from"./pictureUpload-37172669.js";import{a as H}from"./service-f9aa5ca4.js";import J from"./findStyle-a0c3c2cc.js";import{T as R}from"./index-679f783d.js";import"./select-view-c7889b9d.js";import"./index-9201017e.js";import"./index-63a71a35.js";import"./index-862429a3.js";import"./index-025950e7.js";import"./index.browser-7e542916.js";import"./rotate-b978aa33.js";import"./index-6558fc4e.js";import"./scrollIntoView-e2cb9fcb.js";import"./index-aa0053a0.js";import"./form-2546ef10.js";import"./common-874ed4d1.js";import"./service-ad020438.js";import"./index-3fca1566.js";import"./constants-filter-5da7512a.js";import"./image-15044190.js";import"./edit-823cea77.js";import"./index-2fd8deeb.js";import"./mobileFilter-02948859.js";const Ce=({detailData:s,setDetailData:a,setSelectedRow:C,selectedRow:u})=>{const[T,N]=d.useState([]),[B,F]=d.useState(!1),[x,k]=d.useState({}),[W,O]=d.useState(!1),f=d.useRef(null),K=d.useCallback(l.debounce(n=>{f.current=Date.now();const e=f.current;F(!0),N([]),H(n).then(o=>{f.current===e&&o&&(F(!1),N(o))})},500),[]),{data:w}=U(()=>V("CATEGORY")),G=[{title:"品名",dataIndex:"category",align:"center",width:160,render:(n,e,o)=>r(y,{disabled:e.status===1,placeholder:"请选择品名",allowClear:!0,value:e.category,onChange:(i,t)=>{const c=q.filter(S=>S!==e.nanoid),m=u.filter(S=>S.nanoid!==e.nanoid);b(c),C(m);const p=l.cloneDeep(s);i?(p[o].category=i,p[o].categoryName="children"in t?t.children:""):(p[o].category="",p[o].categoryName=""),a(p)},children:w==null?void 0:w.map(i=>r(y.Option,{value:i.key,children:i.title},i.id))})},{title:"款号",dataIndex:"styleId",align:"center",width:300,render:(n,e,o)=>{var i;return e.styleId?h(g.Group,{compact:!0,children:[r(g,{disabled:!0,value:(i=e==null?void 0:e.style)==null?void 0:i.styleCode,style:{width:"75%"}}),r(I,{style:{width:"25%"},status:"danger",onClick:()=>{const t=l.cloneDeep(s);t[o].styleId="",a(t)},children:"修改"})]}):h(g.Group,{compact:!0,children:[r(y,{style:{width:"75%"},showSearch:!0,placeholder:"根据款号/标签搜索",filterOption:!1,renderFormat:t=>t.children.props.children[1],notFoundContent:B?r("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:r(A,{style:{margin:12}})}):null,onSearch:K,onChange:t=>{const c=l.cloneDeep(s);c[o].styleId=(t==null?void 0:t.id)||"",c[o].style=t||"",c[o].category=(t==null?void 0:t.category)||"",c[o].categoryName=(t==null?void 0:t.categoryName)||"",a(c)},children:T.map(t=>r(y.Option,{value:t,children:t.styleCode},t.id))}),r(I,{style:{width:"25%"},type:"primary",onClick:()=>{k(e),O(!0)},children:"检索"})]})}},{title:"图片",dataIndex:"imgSrc",align:"center",render:(n,e,o)=>r(z,{url:e.imgSrc,onChange:i=>{var c,m;const t=l.cloneDeep(s);t[o].imgSrc=(m=(c=i[0])==null?void 0:c.response)==null?void 0:m.src,a(t)}})},{title:"圈号",dataIndex:"circle",align:"center",width:100,render:(n,e,o)=>r(g,{disabled:e.status===1,value:e.circle,onChange:i=>{const t=l.cloneDeep(s);t[o].circle=i,a(t)}})},{title:"件重",dataIndex:"singleWeight",align:"center",width:100,render:(n,e,o)=>r(E,{disabled:e.status===1,value:e.singleWeight,onChange:i=>{const t=l.cloneDeep(s);t[o].singleWeight=i,t[o].totalWeight=e.quantity&&i&&Number((Number(e.quantity)*Number(i)).toFixed(2)),a(t)}})},{title:"数量",dataIndex:"quantity",align:"center",width:100,render:(n,e,o)=>r(E,{disabled:e.status===1,value:e.quantity,onChange:i=>{const t=l.cloneDeep(s);t[o].quantity=i,t[o].totalWeight=i&&e.singleWeight&&Number((Number(i)*Number(e.singleWeight)).toFixed(2)),a(t)}})},{title:"状态",align:"center",dataIndex:"status",width:100,render:n=>h(j,{children:[n===0&&r(R,{color:"red",children:"未排产"}),n===1&&r(R,{color:"green",children:"已排产"})]})},{title:"总重",align:"center",dataIndex:"totalWeight",width:100},{title:"操作",align:"center",width:120,render:(n,e,o)=>r(I,{disabled:e.status===1,type:"text",onClick:()=>P(e.id,o),children:"删除"})}],P=async(n,e)=>{n&&await Y(n),a(s.filter((o,i)=>i!==e))},[q,b]=d.useState([]);return d.useEffect(()=>{b(u.map(n=>n.nanoid))},[u]),h(j,{children:[W&&r(J,{visible:W,style:x,onClose:n=>{const e=l.cloneDeep(x);e.styleId=(n==null?void 0:n.id)||"",e.style=n||"",e.category=(n==null?void 0:n.category)||"",e.categoryName=(n==null?void 0:n.categoryName)||"";const o=l.cloneDeep(s),i=o.find(t=>t.nanoid===e.nanoid);Object.assign(i,e),a(o),O(!1),k({})}}),r(L,{scroll:{y:window.screen.height-300},columns:G,data:s,pagination:!1,rowKey:"nanoid",rowSelection:{type:"checkbox",selectedRowKeys:q,onChange:(n,e)=>{b(n),C(e)},checkboxProps:n=>({disabled:!n.category||n.status===1})}})]})};export{Ce as default};
